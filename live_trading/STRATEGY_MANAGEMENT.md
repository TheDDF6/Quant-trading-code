# 策略管理功能使用指南

## 📋 概述

策略管理功能允许您在运行时动态添加、删除、修改和克隆交易策略，无需手动编辑配置文件。所有操作都会自动保存到配置文件中，确保配置持久化。

## 🚀 主要功能

### 1. 查看功能
- **查看当前策略**: 显示所有已配置的策略及其状态
- **查看可用策略类型**: 列出系统中所有可用的策略模板

### 2. 管理功能
- **添加新策略**: 交互式创建新的策略实例
- **删除策略**: 安全删除现有策略
- **修改策略配置**: 调整策略参数、资金分配等
- **克隆策略**: 基于现有策略创建新实例

### 3. 验证功能
- **配置验证**: 检查所有策略配置的有效性
- **参数验证**: 确保策略参数在合理范围内

## 🎛️ 如何使用

### 方式一: 在主程序中使用

1. 启动交易系统:
   ```bash
   python main_v2.py
   ```

2. 在主菜单选择 "5. 策略管理菜单"

3. 根据需要选择相应功能

### 方式二: 独立策略管理工具

1. 运行独立管理工具:
   ```bash
   python strategy_manager_demo.py
   ```

2. 在弹出的菜单中选择操作

## 📝 添加新策略示例

### 步骤详解

1. **选择策略类型**
   - 系统会显示所有可用的策略类型
   - 每种策略都有描述和风险等级说明

2. **输入策略ID**
   - 为新策略实例输入唯一标识符
   - 例如: `rsi_btc_conservative`, `ma_eth_aggressive`

3. **配置基本参数**
   - **资金分配**: 为该策略分配的资金比例
   - **支持交易对**: 策略将交易的品种
   - **高级参数**: 策略特定的技术参数

4. **验证和保存**
   - 系统会验证配置的有效性
   - 确认后自动保存到配置文件

### 示例操作流程

```
🔧 添加新策略
================

📋 可用策略类型:
========================

📂 技术指标:
  1. RSIDivergenceV2
     描述: 基于RSI背离的交易策略，适合震荡和反转行情
     风险: 中等

📂 趋势跟踪:
  2. MovingAverageCrossover
     描述: 经典的双均线交叉策略，适合趋势行情
     风险: 中等

请选择策略类型编号: 1
✅ 已选择: RSIDivergenceV2

请输入策略实例ID: rsi_btc_scalping

⚙️  配置策略参数 (RSIDivergenceV2):
当前剩余可分配资金: 100.0%
请输入资金分配比例 (0-100.0%, 默认 20%): 25

请输入支持的交易对 (默认: ['BTC-USDT-SWAP']): BTC-USDT-SWAP

是否配置高级参数? (y/N): y

🔧 高级参数配置:
单笔风险比例 (0.5-5.0%, 默认 2.0%): 1.5
止损比例 (0.5-10.0%, 默认 1.5%): 1.2
RSI周期 (5-50, 默认 14): 10

📋 策略配置预览:
================
策略ID: rsi_btc_scalping
策略类型: RSIDivergenceV2
资金分配: 25.0%
支持品种: ['BTC-USDT-SWAP']
风险比例: 1.5%

确认添加此策略? (Y/n): y
✅ 策略 'rsi_btc_scalping' 已成功添加并保存
```

## ⚙️ 策略参数说明

### RSI背离策略参数

| 参数名 | 说明 | 默认值 | 取值范围 |
|--------|------|--------|----------|
| rsi_period | RSI计算周期 | 14 | 5-50 |
| rsi_oversold | RSI超卖阈值 | 30 | 10-40 |
| rsi_overbought | RSI超买阈值 | 70 | 60-90 |
| lookback | 背离检测回看期 | 20 | 10-50 |
| stop_loss_pct | 止损比例 | 1.5% | 0.5%-10% |
| take_profit_ratio | 止盈倍数 | 1.5倍 | 1.0-5.0倍 |
| risk_per_trade | 单笔风险 | 2% | 0.5%-5% |

### 移动平均交叉策略参数

| 参数名 | 说明 | 默认值 | 取值范围 |
|--------|------|--------|----------|
| fast_period | 快线周期 | 10 | 3-20 |
| slow_period | 慢线周期 | 20 | 10-100 |
| ma_type | 均线类型 | EMA | SMA/EMA/WMA |
| stop_loss_pct | 止损比例 | 2% | 0.5%-10% |
| take_profit_ratio | 止盈倍数 | 2.0倍 | 1.0-5.0倍 |
| risk_per_trade | 单笔风险 | 1.5% | 0.5%-5% |

## 💰 资金分配管理

### 分配原则
- **总和限制**: 所有活跃策略的分配比例不应超过100%
- **预留资金**: 建议保留10-20%资金作为缓冲
- **动态调整**: 可以随时调整策略的资金分配

### 分配建议
- **新手**: 单个策略不超过20%
- **进阶**: 根据策略表现调整，优秀策略可分配更多
- **风险控制**: 高风险策略分配较少资金

## 🛡️ 风险管理

### 自动验证
- **参数范围检查**: 确保所有参数在合理范围内
- **资金分配检查**: 防止过度分配
- **配置完整性检查**: 确保必要配置项完整

### 安全措施
- **删除确认**: 删除策略需要输入"DELETE"确认
- **配置备份**: 每次保存前自动备份原配置
- **错误恢复**: 配置错误时可恢复到备份版本

## 📊 策略状态监控

### 状态显示
- **🟢 启用**: 策略正在运行
- **⚪ 禁用**: 策略已配置但未启用
- **资金分配**: 显示分配的资金比例
- **支持品种**: 显示策略交易的币种

### 统计信息
- **总交易**: 策略执行的交易次数
- **胜率**: 盈利交易占比
- **总盈亏**: 累计盈亏金额
- **风险等级**: 当前风险评估

## 🔄 配置持久化

### 自动保存
- 所有操作完成后自动保存到配置文件
- 配置文件位置: `config/multi_strategy_config.json`
- 备份文件位置: `config/multi_strategy_config.json.bak`

### 热重载
- 支持运行时重新加载配置
- 新添加的策略需要重启系统才能生效
- 参数修改可以通过重载配置立即生效

## 🆘 常见问题

### Q: 添加策略后为什么没有生效？
A: 新添加的策略需要重启交易系统才能生效。已有策略的参数修改可以通过配置重载生效。

### Q: 资金分配超过100%怎么办？
A: 系统会发出警告，建议调整策略分配比例使总和不超过100%。

### Q: 删除策略后资金如何处理？
A: 删除策略会释放其分配的资金，可以重新分配给其他策略。

### Q: 如何恢复误删的策略？
A: 可以从备份配置文件 (`*.bak`) 中恢复，或使用克隆功能重新创建类似策略。

### Q: 策略参数修改后何时生效？
A: 大部分参数修改需要策略重新启动才生效。建议在市场休市时进行重要参数调整。

## 📚 扩展功能

### 未来计划
- **策略模板导入导出**: 支持策略配置的导入导出
- **策略性能分析**: 详细的策略表现分析报告
- **策略组合优化**: 自动优化策略组合和资金分配
- **实时参数调整**: 支持运行时实时调整策略参数

### 自定义策略
如需添加自定义策略类型，请参考现有策略实现，继承 `BaseStrategy` 类，并在 `StrategyRegistry` 中注册。

---

**注意**: 策略管理涉及资金安全，请在充分理解每个参数含义后进行操作。建议先在沙盒环境测试策略配置。